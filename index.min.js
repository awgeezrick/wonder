"use strict";var Config={URL_GET_GOOGLE_AUTOCOMPLETE_DATA:"https://wonder.vannizhang.com/data.json",URL_QUERY:"https://api.vannizhang.com",STATES_ABBREVIATION:{AL:"Alabama",AK:"Alaska",AZ:"Arizona",AR:"Arkansas",CA:"California",CO:"Colorado",CT:"Connecticut",DE:"Delaware",DC:"Washington DC",FL:"Florida",GA:"Georgia",GU:"Guam",HI:"Hawaii",ID:"Idaho",IL:"Illinois",IN:"Indiana",IA:"Iowa",KS:"Kansas",KY:"Kentucky",LA:"Louisiana",ME:"Maine",MD:"Maryland",MA:"Massachusetts",MI:"Michigan",MN:"Minnesota",MS:"Mississippi",MO:"Missouri",MT:"Montana",NE:"Nebraska",NV:"Nevada",NH:"New Hampshire",NJ:"New Jersey",NM:"New Mexico",NY:"New York",NC:"North Carolina",ND:"North Dakota",OH:"Ohio",OK:"Oklahoma",OR:"Oregon",PA:"Pennsylvania",PR:"Puerto Rico",RI:"Rhode Island",SC:"South Carolina",SD:"South Dakota",TN:"Tennessee",TX:"Texas",UT:"Utah",VT:"Vermont",VA:"Virginia",WA:"Washington State",WV:"West Virginia",WI:"Wisconsin",WY:"Wyoming"}},Controller=function(){var a=null,b=null,c=null,f=new HashDataManager,h=function(u){var v=document.getElementById(u),w=v.getBoundingClientRect();m(u,w.left),c.toggleActiveHexPolygon(v)},k=function(u){a=u},l=function(u){var v=Config.STATES_ABBREVIATION[u];return a[v]},m=function(u,v,w){var y="boolean"==typeof w&&w||!b.isSticky();if(y){var z=l(u);b.show(z,v),f.setHashData(u)}},p=function(u,v){var w=new XMLHttpRequest;w.open("GET",u,!0),w.onload=function(){if(!(200<=this.status&&400>this.status));else if(this.response&&v){var y=JSON.parse(this.response);v(y)}},w.onerror=function(){},w.send()},t=function(u){u=u||5;var v=60000*u,w=new Date,y=new Date(Math.floor(w.getTime()/v)*v).getTime();return y/1e3};return{init:function g(u){b=u.infoWindow||null,c=u.svgMap||null;var v=f.getHashData();v&&h(v)},loadData:function j(u){var v=Config.URL_GET_GOOGLE_AUTOCOMPLETE_DATA+"?"+t(5);p(v,function(w){w.error||(k(w),u&&u())})},showInfoPanel:m,hideInfoPanel:function n(){b.isSticky()||(b.hide(),f.setHashData())},getSearchTerm:function r(u){var v=encodeURI(Config.URL_QUERY+"/getWonderSearchTerm?stateID="+u);p(v)},getTargetQuery:function s(u){var v=encodeURI(Config.URL_QUERY+"/getWonderTargetQuery?query="+u);p(v)},toggleStickInfoPanel:function o(u){b.toggleIsSticky(u)}}},SvgMap=function(){var a=null,b=document.querySelectorAll("#Layer1 polygon"),c=document.querySelectorAll("#Layer1 text"),g=function(){b.forEach(function(m){m.addEventListener("mouseover",function(n){h(n)}),m.addEventListener("mouseout",function(){h()}),m.addEventListener("click",function(n){var o=n.currentTarget;k(o),h(n)})})},h=function(m){if(m){var n=m.currentTarget,o=m.clientX,p=n.getAttribute("id"),r=!("click"!==m.type);a.showInfoPanel(p,o,r),j(p)}else a.hideInfoPanel(),j()},j=function(m){b.forEach(function(n){n.id===m?n.classList.add("is-hover"):n.classList.remove("is-hover")}),c.forEach(function(n){n.getAttribute("data-target")===m?n.classList.add("is-hover"):n.classList.remove("is-hover")})},k=function(m){var n=!!m&&m.classList.contains("is-active"),o=m&&!n?m:null;l(o),a.toggleStickInfoPanel(!!o),o&&a.getSearchTerm(m.id)},l=function(m){b.forEach(function(n){n===m?n.classList.add("is-active"):n.classList.remove("is-active")}),c.forEach(function(n){m&&n.getAttribute("data-target")===m.id?n.classList.add("is-active"):n.classList.remove("is-active")})};return{init:function f(m){a=m,g()},setActiveHexPolygon:l,toggleActiveHexPolygon:k}},InfoWindow=function(a){a=a||{};var b=!1,c=null,f=a.container?document.getElementById(a.container):null,g=a.infoWindowOnCloseHandler||null,j=function(){document.querySelectorAll(".js-open-link").forEach(function(t){t.addEventListener("click",function(u){k(u.target.innerHTML)})}),document.querySelectorAll(".js-close-panel").forEach(function(t){t.addEventListener("click",function(){m(),o(!1),g&&g()})})},k=function(t){t=t.replace(/\s/g,"+");var u="https://www.google.com/search?q="+t;c.getTargetQuery(t),window.open(u,"_blank")},m=function(){r(null),f.classList.add("hide")},o=function(t){t="boolean"==typeof t?t:!b,b=t},p=function(t){var u=window.innerWidth/2;!!(t<=u)?f.classList.add("is-right"):f.classList.remove("is-right")},r=function(t){var u=t?s(t):"";f.innerHTML=u,j()},s=function(t){var u=t.map(function(v,w){var y=v.autocompletes.map(function(A){return"<p class=\"font-size--2 trailer-0 js-open-link cursor-pointer\">"+A+"</p>"}).join(""),z=1===w?"is-middle-section":"";return"<div class=\"info-window-content "+z+"\">"+y+"</div>"}).join("");return"<div class=\"info-window\"><div class=\"text-right leader-half\"><span class=\"icon-ui-close margin-right-half cursor-pointer js-close-panel\"></span></div>"+u+"</div>"};return{init:function h(t){return f?void(c=t):void console.error("container DOM ID is required to init info panel")},show:function l(t,u){r(t),p(u),f.classList.remove("hide")},hide:m,toggleIsSticky:o,isSticky:function n(){return b}}},HashDataManager=function(){return{getHashData:function a(){var c=window.location.hash;return c?c.substring(1):null},setHashData:function b(){var c=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"";window.location.hash=c}}};document.addEventListener("DOMContentLoaded",function(){var b=new Controller,c=new SvgMap,f=new InfoWindow({container:"infoWindowDiv",infoWindowOnCloseHandler:function infoWindowOnCloseHandler(){c.setActiveHexPolygon(null),b.hideInfoPanel()}});b.loadData(function(){f.init(b),c.init(b),b.init({infoWindow:f,svgMap:c})})});